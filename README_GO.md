# 能源看板系統 - Go 版本

## 系統概述

這是使用 **Go 語言** 重寫的能源看板系統，完全取代了之前的 Python 版本。

### 主要優勢
- ✅ **零依賴部署** - 目標電腦無需安裝任何運行環境
- ✅ **檔案體積小** - 編譯後約 5-15MB
- ✅ **啟動速度快** - 原生執行效能
- ✅ **記憶體佔用低** - 高效率的資源使用
- ✅ **跨平台支援** - Windows/Linux/macOS

## 系統架構

```
電表 ↔ LabVIEW (port 8888) ↔ Go Web伺服器 (port 5177) ↔ 瀏覽器
```

## 檔案結構

### 開發檔案
```
專案目錄/
├── main.go              # Go 主程式
├── go.mod               # Go 模組檔案
├── build.bat            # Windows 編譯腳本
├── start.bat            # 啟動腳本
└── README_GO.md         # 說明文件
```

### 網頁檔案
```
專案目錄/
├── energy_dashboard.html    # 能源看板網頁
├── css/
│   └── energy_dashboard.css # 樣式檔案
└── final.json              # 資料交換檔案
```

### 部署檔案 (編譯後)
```
部署包/
├── web_server.exe          # Go 編譯的執行檔 (零依賴)
├── energy_dashboard.html   # 網頁檔案
├── css/                    # 樣式目錄
├── final.json             # 資料檔案
├── start.bat              # 啟動腳本
└── LabVIEW_installer/      # LabVIEW 安裝程式
```

## 開發環境需求

### 編譯階段 (開發機器)
- Windows 10/11
- Go 1.19+ 
- 網路連線 (下載 Go 環境)

### 部署階段 (目標電腦)
- Windows 11 (全新安裝)
- **無需任何額外軟體**

## 編譯與部署

### 1. 準備開發環境

#### 安裝 Go 語言
1. 下載 Go 安裝包: https://golang.org/dl/
2. 安裝 Go (選擇 Windows installer)
3. 驗證安裝: `go version`

### 2. 編譯程式

#### 方法 1: 使用編譯腳本
```batch
build.bat
```

#### 方法 2: 手動編譯
```bash
# 設定編譯參數
set GOOS=windows
set GOARCH=amd64
set CGO_ENABLED=0

# 編譯 (壓縮優化)
go build -ldflags="-s -w" -o web_server.exe main.go
```

### 3. 準備部署包
```
部署包/
├── web_server.exe          # 剛編譯的執行檔
├── energy_dashboard.html   # 從開發目錄複製
├── css/                    # 從開發目錄複製
├── final.json             # 從開發目錄複製
├── start.bat              # 從開發目錄複製
└── LabVIEW_installer/      # LabVIEW 安裝程式
```

## 目標電腦安裝流程

### 1. 安裝 LabVIEW
```batch
# 執行 LabVIEW 安裝程式
LabVIEW_installer\setup.exe
```

### 2. 部署能源看板系統
1. 將整個部署包複製到目標電腦
2. 無需安裝任何額外軟體
3. 直接執行 `start.bat`

### 3. 啟動系統
```batch
# 雙擊執行
start.bat
```

## 功能特性

### Web 伺服器功能
- **HTTP 伺服器** (port 5177) - 提供網頁服務
- **TCP 客戶端** - 每 5 秒向 LabVIEW 查詢電表資料
- **自動開啟瀏覽器** - 啟動後自動顯示能源看板
- **CORS 支援** - 跨域資源共享
- **靜態檔案服務** - 提供 HTML/CSS/JS 檔案

### 通訊協議
- **完全相容** `localhost.md` 規格
- **CheckSum 驗證** - 確保資料完整性
- **錯誤重試** - 自動處理連線失敗
- **超時保護** - 避免程式卡死

### 資料處理
- **即時更新** - 每 5 秒更新電表資料
- **JSON 格式** - 標準資料交換格式
- **UTF-8 支援** - 完整中文支援
- **檔案同步** - 自動寫入 `final.json`

## 系統優化

### 編譯優化
```bash
-ldflags="-s -w"    # 移除符號表和除錯資訊
CGO_ENABLED=0       # 禁用 CGO，確保純靜態編譯
```

### 效能特色
- **併發處理** - Goroutine 處理多任務
- **記憶體效率** - 低記憶體佔用
- **快速啟動** - 秒級啟動時間
- **穩定性** - 優雅的錯誤處理

## 錯誤處理

### 連線錯誤
- LabVIEW 未啟動 → 顯示連線錯誤，繼續重試
- 電表無回應 → 跳過本次更新，下次重試
- 網路問題 → 自動重新連線

### 資料錯誤
- JSON 格式錯誤 → 記錄錯誤，跳過更新
- CheckSum 錯誤 → 要求重新傳送
- 檔案寫入失敗 → 記錄錯誤，繼續運行

### 系統錯誤
- Port 佔用 → 顯示錯誤訊息並退出
- 檔案缺失 → 檢查並提示所需檔案
- 權限不足 → 提示管理員權限

## 日誌與除錯

### 日誌格式
```
[15:04:05] 成功更新電表資料
[15:04:06] GET /energy_dashboard.html
[15:04:10] 連線錯誤: connection refused
```

### 除錯技巧
1. 檢查 LabVIEW 是否在 port 8888 運行
2. 確認防火牆設定
3. 查看控制台輸出的錯誤訊息
4. 驗證 `final.json` 檔案內容

## 系統需求

### 最低需求
- Windows 11
- 100MB 可用磁碟空間
- 64MB 可用記憶體

### 建議需求
- Windows 11 (最新更新)
- 1GB 可用磁碟空間
- 256MB 可用記憶體
- 現代瀏覽器 (Edge/Chrome/Firefox)

## 安全性考量

### 網路安全
- 僅監聽 localhost
- 無對外網路需求
- 防火牆友善設計

### 檔案安全
- 唯讀檔案存取
- 安全的檔案寫入
- 路徑遍歷保護

## 故障排除

### 常見問題

**Q: 執行 web_server.exe 沒有反應**
A: 檢查是否有防毒軟體阻擋，或確認檔案完整性

**Q: 網頁顯示連線錯誤**
A: 確認 LabVIEW 是否在 port 8888 運行

**Q: 資料不更新**
A: 檢查 `final.json` 檔案是否可寫入

**Q: 編譯失敗**
A: 確認 Go 環境正確安裝，版本 1.19+

### 聯繫支援
如有問題，請提供：
1. 錯誤訊息截圖
2. 系統版本資訊
3. 操作步驟描述

---

## 總結

Go 版本的能源看板系統提供了最佳的部署體驗：
- 🚀 **零安裝依賴** - 目標電腦完全無需額外軟體
- ⚡ **高效執行** - 原生效能，低資源佔用
- 🔧 **易於維護** - 單一執行檔，簡化部署
- 🛡️ **穩定可靠** - 完善的錯誤處理機制

是離線環境部署的理想選擇！ 